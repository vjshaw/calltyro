<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calltyro - Content Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            color: #333;
        }

        /* Header */
        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4f46e5;
            text-decoration: none;
        }

        .admin-badge {
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
        }

        .btn-secondary {
            background: #10b981;
            color: white;
        }

        .btn-secondary:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #6b7280;
            font-size: 1.1rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .tab {
            flex: 1;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6b7280;
        }

        .tab.active {
            background: #4f46e5;
            color: white;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4f46e5;
            display: block;
        }

        .stat-label {
            color: #6b7280;
            margin-top: 0.5rem;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Forms */
        .form-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-input, .form-textarea, .form-select {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.5rem;
            min-height: 45px;
            align-items: center;
        }

        .tag {
            background: #4f46e5;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tag-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
        }

        .tag-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
            padding: 0.5rem;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #4f46e5;
            background: #f8fafc;
        }

        .file-upload.dragover {
            border-color: #4f46e5;
            background: #ede9fe;
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #6b7280;
        }

        .upload-text {
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .upload-subtext {
            font-size: 0.875rem;
            color: #9ca3af;
        }

        /* Topics Table */
        .topics-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8fafc;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: top;
        }

        .table tr:hover {
            background: #f8fafc;
        }

        .topic-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .topic-meta {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .subject-badge {
            background: #e0f2fe;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .difficulty-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .difficulty-beginner {
            background: #dcfce7;
            color: #166534;
        }

        .difficulty-intermediate {
            background: #fef3c7;
            color: #a16207;
        }

        .difficulty-advanced {
            background: #fee2e2;
            color: #991b1b;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .table-responsive {
                overflow-x: auto;
            }
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .message.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div>
                <a href="dashboard.html" class="logo">Calltyro</a>
                <span class="admin-badge">ADMIN</span>
            </div>
            <div class="header-actions">
                <a href="content-library.html" class="btn btn-secondary">View Public Library</a>
                <a href="dashboard.html" class="btn btn-primary">Back to Dashboard</a>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">📚 Content Management</h1>
            <p class="page-subtitle">Manage learning topics, import new content, and track performance</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">📊 Overview</button>
            <button class="tab" onclick="showTab('create')">➕ Create Topic</button>
            <button class="tab" onclick="showTab('manage')">📝 Manage Topics</button>
            <button class="tab" onclick="showTab('import')">📤 Bulk Import</button>
            <button class="tab" onclick="showTab('analytics')">📈 Analytics</button>
        </div>

        <!-- Messages Container -->
        <div id="messageContainer"></div>

        <!-- Overview Tab -->
        <div id="overview" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📚</div>
                    <span class="stat-number" id="totalTopics">-</span>
                    <div class="stat-label">Total Topics</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🎯</div>
                    <span class="stat-number" id="activeTopics">-</span>
                    <div class="stat-label">Active Topics</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <span class="stat-number" id="totalCalls">-</span>
                    <div class="stat-label">Total Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⭐</div>
                    <span class="stat-number" id="averageRating">-</span>
                    <div class="stat-label">Average Rating</div>
                </div>
            </div>

            <div class="form-container">
                <h3>📈 Recent Activity</h3>
                <div id="recentActivity">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading recent activity...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Topic Tab -->
        <div id="create" class="content-section">
            <div class="form-container">
                <h3>➕ Create New Learning Topic</h3>
                <form id="createTopicForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Topic Title *</label>
                            <input type="text" class="form-input" name="title" required 
                                   placeholder="e.g., Romeo and Juliet Character Analysis">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Subject *</label>
                            <select class="form-select" name="subject" required>
                                <option value="">Select Subject</option>
                                <option value="Literature">Literature</option>
                                <option value="Science">Science</option>
                                <option value="History">History</option>
                                <option value="Math">Mathematics</option>
                                <option value="English">English</option>
                                <option value="Social Studies">Social Studies</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Difficulty Level *</label>
                            <select class="form-select" name="difficulty_level" required>
                                <option value="">Select Difficulty</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Estimated Duration (minutes) *</label>
                            <input type="number" class="form-input" name="estimated_duration" 
                                   required min="5" max="60" placeholder="e.g., 18">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Grade Levels *</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" name="grade_levels" value="k-2" id="grade-k2">
                                <label for="grade-k2">K-2nd Grade</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="grade_levels" value="3-5" id="grade-35">
                                <label for="grade-35">3rd-5th Grade</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="grade_levels" value="6-8" id="grade-68">
                                <label for="grade-68">6th-8th Grade</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="grade_levels" value="9-12" id="grade-912">
                                <label for="grade-912">9th-12th Grade</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="grade_levels" value="college" id="grade-college">
                                <label for="grade-college">College</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <textarea class="form-textarea" name="description" required 
                                  placeholder="Describe what students will learn and discuss in this topic..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tags</label>
                        <div class="tag-input-container" id="tagContainer">
                            <input type="text" class="tag-input" placeholder="Add tags and press Enter..." 
                                   onkeypress="handleTagInput(event)">
                        </div>
                        <small>Press Enter to add tags. These help students find your content.</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Learning Objectives</label>
                        <textarea class="form-textarea" name="learning_objectives" 
                                  placeholder="What will students learn? (one per line)&#10;• Analyze character development&#10;• Understand dramatic irony&#10;• Discuss themes of love and fate"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Prerequisites</label>
                        <textarea class="form-textarea" name="prerequisites" 
                                  placeholder="What should students know before this topic? (one per line)&#10;• Basic understanding of drama structure&#10;• Reading comprehension skills"></textarea>
                    </div>

                    <div style="margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary">Create Topic</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manage Topics Tab -->
        <div id="manage" class="content-section">
            <div class="form-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>📝 Manage Existing Topics</h3>
                    <div style="display: flex; gap: 1rem;">
                        <input type="text" class="form-input" placeholder="Search topics..." 
                               onkeyup="searchTopics(this.value)" style="width: 250px;">
                        <select class="form-select" onchange="filterTopics(this.value)" style="width: 150px;">
                            <option value="">All Subjects</option>
                            <option value="Literature">Literature</option>
                            <option value="Science">Science</option>
                            <option value="History">History</option>
                            <option value="Math">Mathematics</option>
                            <option value="English">English</option>
                            <option value="Social Studies">Social Studies</option>
                        </select>
                    </div>
                </div>

                <div class="topics-table">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Topic</th>
                                    <th>Subject</th>
                                    <th>Grade Levels</th>
                                    <th>Difficulty</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="topicsTableBody">
                                <tr>
                                    <td colspan="7">
                                        <div class="loading">
                                            <div class="spinner"></div>
                                            <p>Loading topics...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Import Tab -->
        <div id="import" class="content-section">
            <div class="form-container">
                <h3>📤 Bulk Import Topics</h3>
                <p style="margin-bottom: 2rem;">Import multiple topics from CSV or Excel files. Download the template to see the required format.</p>

                <div style="margin-bottom: 2rem;">
                    <a href="#" class="btn btn-secondary" onclick="downloadTemplate()">📄 Download CSV Template</a>
                    <a href="#" class="btn btn-secondary" onclick="downloadExampleData()">📋 Download Example Data</a>
                </div>

                <div class="file-upload" id="fileUpload" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">Click to select file or drag and drop</div>
                    <div class="upload-subtext">Supports CSV, Excel (.xlsx, .xls) files up to 10MB</div>
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;" 
                           onchange="handleFileSelect(event)">
                </div>

                <div id="uploadPreview" style="display: none; margin-top: 2rem;">
                    <h4>📋 Import Preview</h4>
                    <div id="previewTable"></div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary" onclick="processImport()">Import Topics</button>
                        <button class="btn btn-secondary" onclick="cancelImport()">Cancel</button>
                    </div>
                </div>

                <div id="importProgress" style="display: none; margin-top: 2rem;">
                    <h4>⏳ Import Progress</h4>
                    <div style="background: #f3f4f6; border-radius: 8px; padding: 1rem;">
                        <div id="progressBar" style="background: #4f46e5; height: 10px; border-radius: 5px; width: 0%; transition: width 0.3s ease;"></div>
                        <div id="progressText" style="margin-top: 0.5rem; text-align: center;">Preparing import...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="content-section">
            <div class="form-container">
                <h3>📈 Content Analytics</h3>
                <div id="analyticsContent">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading analytics...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE_URL = 'https://your-domain.com/api'; // Update this!
        let currentTopics = [];
        let selectedTags = [];
        let uploadedFile = null;

        // Initialize page
        window.addEventListener('load', function() {
            checkAdminAccess();
            loadOverviewData();
        });

        // Check if user has admin access
        function checkAdminAccess() {
            const user = localStorage.getItem('callty_user');
            if (!user) {
                window.location.href = 'auth.html';
                return;
            }

            try {
                const userData = JSON.parse(user);
                // In a real implementation, check if user.role === 'admin'
                console.log('Admin access granted for:', userData.email);
            } catch (error) {
                window.location.href = 'auth.html';
            }
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected content section
            document.getElementById(tabName).classList.add('active');

            // Activate selected tab
            event.target.classList.add('active');

            // Load data for specific tabs
            switch (tabName) {
                case 'overview':
                    loadOverviewData();
                    break;
                case 'manage':
                    loadTopicsTable();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        // Load overview data
        async function loadOverviewData() {
            try {
                const token = localStorage.getItem('callty_token');
                
                // Sample data for testing
                const sampleStats = {
                    totalTopics: 24,
                    activeTopics: 22,
                    totalCalls: 156,
                    averageRating: 4.2
                };

                document.getElementById('totalTopics').textContent = sampleStats.totalTopics;
                document.getElementById('activeTopics').textContent = sampleStats.activeTopics;
                document.getElementById('totalCalls').textContent = sampleStats.totalCalls;
                document.getElementById('averageRating').textContent = sampleStats.averageRating.toFixed(1);

                // Load recent activity
                const recentActivity = document.getElementById('recentActivity');
                recentActivity.innerHTML = `
                    <div style="display: grid; gap: 1rem;">
                        <div style="padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #10b981;">
                            <strong>New topic created:</strong> "DNA Structure and Function" (Science)
                            <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">2 hours ago</div>
                        </div>
                        <div style="padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #4f46e5;">
                            <strong>Topic updated:</strong> "Romeo and Juliet" - Added learning objectives
                            <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">5 hours ago</div>
                        </div>
                        <div style="padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <strong>Bulk import completed:</strong> 12 new History topics added
                            <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">Yesterday</div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        // Load topics table
        async function loadTopicsTable() {
            const tableBody = document.getElementById('topicsTableBody');
            
            try {
                // Sample data for testing
                const sampleTopics = [
                    {
                        id: 1,
                        title: 'Romeo and Juliet Character Analysis',
                        subject: 'Literature',
                        grade_levels: ['9-12'],
                        difficulty_level: 'intermediate',
                        estimated_duration: 18,
                        is_active: true
                    },
                    {
                        id: 2,
                        title: 'Photosynthesis Process',
                        subject: 'Science',
                        grade_levels: ['6-8', '9-12'],
                        difficulty_level: 'beginner',
                        estimated_duration: 15,
                        is_active: true
                    },
                    {
                        id: 3,
                        title: 'Civil War Causes and Effects',
                        subject: 'History',
                        grade_levels: ['6-8', '9-12'],
                        difficulty_level: 'intermediate',
                        estimated_duration: 22,
                        is_active: false
                    }
                ];

                currentTopics = sampleTopics;
                displayTopics(sampleTopics);

            } catch (error) {
                console.error('Error loading topics:', error);
                tableBody.innerHTML = '<tr><td colspan="7">Error loading topics</td></tr>';
            }
        }

        // Display topics in table
        function displayTopics(topics) {
            const tableBody = document.getElementById('topicsTableBody');
            
            if (topics.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #6b7280;">No topics found</td></tr>';
                return;
            }

            tableBody.innerHTML = topics.map(topic => `
                <tr>
                    <td>
                        <div class="topic-title">${topic.title}</div>
                        <div class="topic-meta">ID: ${topic.id}</div>
                    </td>
                    <td>
                        <span class="subject-badge">${topic.subject}</span>
                    </td>
                    <td>${topic.grade_levels.join(', ')}</td>
                    <td>
                        <span class="difficulty-badge difficulty-${topic.difficulty_level}">
                            ${topic.difficulty_level}
                        </span>
                    </td>
                    <td>${topic.estimated_duration} min</td>
                    <td>
                        <span style="color: ${topic.is_active ? '#059669' : '#dc2626'};">
                            ${topic.is_active ? '✅ Active' : '❌ Inactive'}
                        </span>
                    </td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-small" onclick="editTopic(${topic.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteTopic(${topic.id})">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Search topics
        function searchTopics(query) {
            const filtered = currentTopics.filter(topic =>
                topic.title.toLowerCase().includes(query.toLowerCase()) ||
                topic.subject.toLowerCase().includes(query.toLowerCase())
            );
            displayTopics(filtered);
        }

        // Filter topics by subject
        function filterTopics(subject) {
            const filtered = subject ? 
                currentTopics.filter(topic => topic.subject === subject) : 
                currentTopics;
            displayTopics(filtered);
        }

        // Tag input handling
        function handleTagInput(event) {
            if (event.key === 'Enter' && event.target.value.trim()) {
                const tag = event.target.value.trim();
                if (!selectedTags.includes(tag)) {
                    selectedTags.push(tag);
                    updateTagDisplay();
                }
                event.target.value = '';
            }
        }

        function updateTagDisplay() {
            const container = document.getElementById('tagContainer');
            const input = container.querySelector('.tag-input');
            
            // Remove existing tags
            container.querySelectorAll('.tag').forEach(tag => tag.remove());
            
            // Add tags before input
            selectedTags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <button type="button" class="tag-remove" onclick="removeTag('${tag}')">&times;</button>
                `;
                container.insertBefore(tagElement, input);
            });
        }

        function removeTag(tag) {
            selectedTags = selectedTags.filter(t => t !== tag);
            updateTagDisplay();
        }

        // Form submission
        document.getElementById('createTopicForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const topicData = {
                title: formData.get('title'),
                description: formData.get('description'),
                subject: formData.get('subject'),
                difficulty_level: formData.get('difficulty_level'),
                estimated_duration: parseInt(formData.get('estimated_duration')),
                grade_levels: formData.getAll('grade_levels'),
                tags: selectedTags,
                learning_objectives: formData.get('learning_objectives')?.split('\n').filter(obj => obj.trim()),
                prerequisites: formData.get('prerequisites')?.split('\n').filter(pre => pre.trim())
            };

            try {
                showMessage('Creating topic...', 'info');
                
                // Simulate API call
                setTimeout(() => {
                    showMessage('Topic created successfully!', 'success');
                    resetForm();
                }, 1000);

            } catch (error) {
                console.error('Error creating topic:', error);
                showMessage('Error creating topic. Please try again.', 'error');
            }
        });

        // Reset form
        function resetForm() {
            document.getElementById('createTopicForm').reset();
            selectedTags = [];
            updateTagDisplay();
        }

        // File upload handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                uploadedFile = file;
                showMessage(`File selected: ${file.name}`, 'info');
                // In real implementation, preview the file content
                document.getElementById('uploadPreview').style.display = 'block';
                document.getElementById('previewTable').innerHTML = `
                    <p>Preview of ${file.name} will appear here...</p>
                    <p>File size: ${(file.size / 1024).toFixed(2)} KB</p>
                `;
            }
        }

        // Download template
        function downloadTemplate() {
            const csvContent = `title,description,subject,grade_levels,difficulty_level,estimated_duration,tags,learning_objectives,prerequisites
"Romeo and Juliet Character Analysis","Explore the complex characters in Shakespeare's famous tragedy","Literature","9-12","intermediate","18","Shakespeare,Character Study,Drama","Analyze character development|Understand dramatic irony","Basic understanding of drama structure"`;
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'callty_topic_template.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Process import
        function processImport() {
            if (!uploadedFile) return;
            
            document.getElementById('importProgress').style.display = 'block';
            
            // Simulate import progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressText').textContent = `Processing... ${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    document.getElementById('progressText').textContent = 'Import completed successfully!';
                    showMessage('Successfully imported topics from file', 'success');
                    setTimeout(() => {
                        cancelImport();
                    }, 2000);
                }
            }, 300);
        }

        // Cancel import
        function cancelImport() {
            document.getElementById('uploadPreview').style.display = 'none';
            document.getElementById('importProgress').style.display = 'none';
            document.getElementById('fileInput').value = '';
            uploadedFile = null;
        }

        // Topic actions
        function editTopic(id) {
            showMessage(`Edit functionality for topic ${id} would open here`, 'info');
        }

        function deleteTopic(id) {
            if (confirm('Are you sure you want to delete this topic?')) {
                showMessage(`Topic ${id} deleted successfully`, 'success');
                // Reload table
                loadTopicsTable();
            }
        }

        // Load analytics
        function loadAnalytics() {
            const analyticsContent = document.getElementById('analyticsContent');
            analyticsContent.innerHTML = `
                <div style="display: grid; gap: 2rem;">
                    <div>
                        <h4>📊 Most Popular Topics</h4>
                        <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                            <ol>
                                <li>Romeo and Juliet Character Analysis (95 calls)</li>
                                <li>The Great Gatsby Symbolism (87 calls)</li>
                                <li>Photosynthesis Process (78 calls)</li>
                                <li>Civil War Causes (65 calls)</li>
                                <li>Algebra Word Problems (52 calls)</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div>
                        <h4>🎯 Subject Performance</h4>
                        <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                            <div style="margin-bottom: 0.5rem;">Literature: 4.3/5 average rating</div>
                            <div style="margin-bottom: 0.5rem;">Science: 4.1/5 average rating</div>
                            <div style="margin-bottom: 0.5rem;">History: 4.0/5 average rating</div>
                            <div style="margin-bottom: 0.5rem;">Math: 3.8/5 average rating</div>
                        </div>
                    </div>

                    <div>
                        <h4>📈 Usage Trends</h4>
                        <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                            <p>Peak usage: Weekday evenings (4-8 PM)</p>
                            <p>Most requested grade level: 9-12th Grade</p>
                            <p>Average session duration: 18.5 minutes</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Utility functions
        function showMessage(text, type = 'info') {
            const container = document.getElementById('messageContainer');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            container.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 5000);
        }

        // Drag and drop for file upload
        const fileUpload = document.getElementById('fileUpload');
        
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        });
        
        fileUpload.addEventListener('dragleave', () => {
            fileUpload.classList.remove('dragover');
        });
        
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const event = { target: { files: files } };
                handleFileSelect(event);
            }
        });
    </script>
</body>
</html>